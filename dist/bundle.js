(()=>{"use strict";const t=300,i="#0066FF",s="#FF0000",e=500;var o;!function(t){t.RADIANT="Radiant",t.AURUM="Aurum",t.SOLARI="Solari"}(o||(o={}));class n{constructor(t,i){this.x=t,this.y=i}distanceTo(t){return Math.sqrt(Math.pow(this.x-t.x,2)+Math.pow(this.y-t.y,2))}normalize(){const t=Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2));return 0===t?new n(0,0):new n(this.x/t,this.y/t)}}class h{constructor(t,i,s=1){this.origin=t,this.direction=i,this.intensity=s}intersects(t,i){const s=new n(this.origin.x-t.x,this.origin.y-t.y),e=this.direction.x*this.direction.x+this.direction.y*this.direction.y,o=2*(s.x*this.direction.x+s.y*this.direction.y);return o*o-4*e*(s.x*s.x+s.y*s.y-i*i)>=0}intersectsPolygon(t){for(let i=0;i<t.length;i++){const s=t[i],e=t[(i+1)%t.length];if(null!==this.intersectsLineSegment(s,e))return!0}return!1}getIntersectionDistance(t){let i=null;for(let s=0;s<t.length;s++){const e=t[s],o=t[(s+1)%t.length],n=this.intersectsLineSegment(e,o);null!==n&&(null===i||n<i)&&(i=n)}return i}intersectsLineSegment(t,i){const s=new n(i.x-t.x,i.y-t.y),e=new n(t.x-this.origin.x,t.y-this.origin.y),o=this.direction.x*s.y-this.direction.y*s.x;if(Math.abs(o)<1e-4)return null;const h=(e.x*s.y-e.y*s.x)/o,a=(e.x*this.direction.y-e.y*this.direction.x)/o;return h>=0&&a>=0&&a<=1?h:null}}class a{constructor(t,i,s){this.position=t,this.sides=i,this.size=s,this.vertices=[],this.rotation=0,this.generateVertices(),this.rotationSpeed=.5*(Math.random()-.5)}generateVertices(){this.vertices=[];for(let t=0;t<this.sides;t++){const i=2*Math.PI*t/this.sides,s=.8+.4*Math.random(),e=this.size*s;this.vertices.push(new n(Math.cos(i)*e,Math.sin(i)*e))}}getWorldVertices(){return this.vertices.map(t=>{const i=Math.cos(this.rotation),s=Math.sin(this.rotation);return new n(this.position.x+t.x*i-t.y*s,this.position.y+t.x*s+t.y*i)})}update(t){this.rotation+=this.rotationSpeed*t}containsPoint(t){const i=this.getWorldVertices();let s=!1;for(let e=0,o=i.length-1;e<i.length;o=e++){const n=i[e].x,h=i[e].y,a=i[o].x,r=i[o].y;h>t.y!=r>t.y&&t.x<(a-n)*(t.y-h)/(r-h)+n&&(s=!s)}return s}}class r{constructor(t,i){this.position=t,this.owner=i,this.health=100,this.efficiency=1}hasLineOfSightToLight(t){return t.length>0}hasLineOfSightToForge(t,i){return!0}generateSolarium(t){return 10*this.efficiency*t}}class l{constructor(t,i){this.position=t,this.owner=i,this.health=1e3,this.isReceivingLight=!1,this.unitQueue=[]}canProduceUnits(){return this.isReceivingLight&&this.health>0}produceUnit(t,i,s){return!(!this.canProduceUnits()||s<i||(this.unitQueue.push(t),0))}updateLightStatus(t,i){this.isReceivingLight=!1;for(const s of t)if(s.hasLineOfSightToLight(i)&&s.hasLineOfSightToForge(this,[])){this.isReceivingLight=!0;break}}}class c{constructor(t,i=1,s=100){this.position=t,this.intensity=i,this.radius=s}emitLight(t){return new h(this.position,t,this.intensity)}}class d{constructor(t,i){this.name=t,this.faction=i,this.solarium=100,this.stellarForge=null,this.solarMirrors=[],this.units=[]}isDefeated(){return null===this.stellarForge||this.stellarForge.health<=0}addSolarium(t){this.solarium+=t}spendSolarium(t){return this.solarium>=t&&(this.solarium-=t,!0)}}class x{constructor(t,i){this.position=t,this.baseColor="#888888",this.currentColor="#888888",this.velocity=i||new n(2*(Math.random()-.5),2*(Math.random()-.5))}update(t){this.position.x+=this.velocity.x*t,this.position.y+=this.velocity.y*t,this.velocity.x*=.98,this.velocity.y*=.98}applyForce(t){this.velocity.x+=t.x,this.velocity.y+=t.y}updateColor(t,i){this.currentColor=t&&i>0?this.blendColors(this.baseColor,t,i):this.baseColor}blendColors(t,i,s){if(!(t&&i&&t.startsWith("#")&&i.startsWith("#")))return this.baseColor;const e=parseInt(t.slice(1),16),o=parseInt(i.slice(1),16);if(isNaN(e)||isNaN(o))return this.baseColor;const n=e>>16&255,h=e>>8&255,a=255&e,r=o>>16&255,l=o>>8&255,c=255&o;return`#${(Math.round(n+(r-n)*s)<<16|Math.round(h+(l-h)*s)<<8|Math.round(a+(c-a)*s)).toString(16).padStart(6,"0")}`}}class u{constructor(t,i){this.position=t,this.rotation=0,this.lifetime=0,this.maxLifetime=2,this.velocity=i,this.rotationSpeed=10*(Math.random()-.5)}update(t){this.position.x+=this.velocity.x*t,this.position.y+=this.velocity.y*t,this.rotation+=this.rotationSpeed*t,this.velocity.x*=.95,this.velocity.y*=.95,this.lifetime+=t}shouldDespawn(){return this.lifetime>=this.maxLifetime}applyCollision(t){this.velocity.x+=.3*t.x,this.velocity.y+=.3*t.y}}class g{constructor(t,i){this.position=t,this.angle=i,this.lifetime=0,this.maxLifetime=.05}update(t){this.lifetime+=t}shouldDespawn(){return this.lifetime>=this.maxLifetime}}class y{constructor(t,i){this.position=t,this.lifetime=0,this.maxLifetime=.5,this.velocity=i}update(t){this.position.x+=this.velocity.x*t,this.position.y+=this.velocity.y*t,this.velocity.y+=100*t,this.velocity.x*=.98,this.velocity.y*=.98,this.lifetime+=t}shouldDespawn(){return this.lifetime>=this.maxLifetime}}class f{constructor(t,i,s,e,o,n){this.position=t,this.owner=i,this.attackRange=e,this.attackDamage=o,this.attackSpeed=n,this.attackCooldown=0,this.target=null,this.health=s,this.maxHealth=s}update(t,i){this.attackCooldown>0&&(this.attackCooldown-=t),this.target&&!this.isTargetDead(this.target)||(this.target=this.findNearestEnemy(i)),this.target&&this.attackCooldown<=0&&this.position.distanceTo(this.target.position)<=this.attackRange&&(this.attack(this.target),this.attackCooldown=1/this.attackSpeed)}isTargetDead(t){return"health"in t&&t.health<=0}findNearestEnemy(t){let i=null,s=1/0;for(const e of t){if("health"in e&&e.health<=0)continue;const t=this.position.distanceTo(e.position);t<s&&(s=t,i=e)}return i}attack(t){"health"in t&&(t.health-=this.attackDamage)}takeDamage(t){this.health-=t}isDead(){return this.health<=0}}class p extends f{constructor(t,i){super(t,i,100,300,10,5),this.lastShotEffects={}}attack(t){super.attack(t);const i=t.position.x-this.position.x,s=t.position.y-this.position.y,e=Math.atan2(s,i);this.lastShotEffects.muzzleFlash=new g(new n(this.position.x,this.position.y),e);const o=e+Math.PI/2+.5*(Math.random()-.5),h=100+50*Math.random();this.lastShotEffects.casing=new u(new n(this.position.x,this.position.y),new n(Math.cos(o)*h,Math.sin(o)*h));const a=e+Math.PI+1*(Math.random()-.5),r=150+100*Math.random();this.lastShotEffects.bouncingBullet=new y(new n(t.position.x,t.position.y),new n(Math.cos(a)*r,Math.sin(a)*r))}getAndClearLastShotEffects(){const t=this.lastShotEffects;return this.lastShotEffects={},t}}class m{constructor(t,i,s){this.position=t,this.owner=s,this.lifetime=0,this.isAttacking=!1,this.targetEnemy=null,this.trail=[],this.velocity=i}update(t,i){if(!this.isAttacking){const s=i.x-this.position.x,e=i.y-this.position.y,o=Math.sqrt(s*s+e*e);if(o>0){const i=s/o,n=e/o,h=300;this.velocity.x+=i*h*t,this.velocity.y+=n*h*t;const a=Math.sqrt(this.velocity.x*this.velocity.x+this.velocity.y*this.velocity.y);if(a<80){const t=80/a;this.velocity.x*=t,this.velocity.y*=t}}}this.position.x+=this.velocity.x*t,this.position.y+=this.velocity.y*t,this.isAttacking&&(this.trail.push(new n(this.position.x,this.position.y)),this.trail.length>15&&this.trail.shift(),this.lifetime+=t),this.isAttacking&&this.targetEnemy&&this.position.distanceTo(this.targetEnemy.position)<10&&("health"in this.targetEnemy&&(this.targetEnemy.health-=15),this.isAttacking=!1,this.trail=[],this.targetEnemy=null)}launchAtTarget(t){this.isAttacking=!0,this.targetEnemy=t,this.trail=[],this.lifetime=0;const i=t.position.x-this.position.x,s=t.position.y-this.position.y,e=Math.sqrt(i*i+s*s);if(e>0){const t=i/e,o=s/e;this.velocity.x=400*t,this.velocity.y=400*o}}returnToOrbit(){this.isAttacking=!1,this.trail=[],this.targetEnemy=null}}class w extends f{constructor(t,i){super(t,i,150,400,15,2),this.projectiles=[],this.projectileLaunchCooldown=0;for(let s=0;s<5;s++){const e=s/5*Math.PI*2,o=50*Math.cos(e),h=50*Math.sin(e),a=80*-Math.sin(e),r=80*Math.cos(e);this.projectiles.push(new m(new n(t.x+o,t.y+h),new n(a,r),i))}}update(t,i){super.update(t,i),this.projectileLaunchCooldown>0&&(this.projectileLaunchCooldown-=t);for(const i of this.projectiles)i.update(t,this.position);if(this.target&&this.projectileLaunchCooldown<=0&&this.position.distanceTo(this.target.position)<=this.attackRange){const t=this.projectiles.find(t=>!t.isAttacking);t&&(t.launchAtTarget(this.target),this.projectileLaunchCooldown=1/this.attackSpeed)}}attack(t){}getProjectiles(){return this.projectiles}}class S{constructor(t,i){this.position=t,this.owner=i,this.chargeTime=0,this.isCharging=!1,this.isComplete=!1,this.health=100,this.hasEmittedShockwave=!1}update(t,i){this.isCharging&&!this.isComplete&&(i?(this.chargeTime+=t,this.chargeTime>=6&&(this.isComplete=!0,this.isCharging=!1)):this.cancel())}startCharging(){this.isCharging=!0,this.chargeTime=0}takeDamage(t){return this.health-=t,this.health<=0&&(this.cancel(),!0)}cancel(){this.isCharging=!1,this.isComplete=!1}shouldEmitShockwave(){return!this.hasEmittedShockwave&&this.chargeTime>=1&&(this.hasEmittedShockwave=!0,!0)}}class F{constructor(){this.players=[],this.suns=[],this.spaceDust=[],this.warpGates=[],this.asteroids=[],this.muzzleFlashes=[],this.bulletCasings=[],this.bouncingBullets=[],this.gameTime=0,this.isRunning=!1}update(t){this.gameTime+=t;for(const i of this.asteroids)i.update(t);for(const i of this.players)if(!i.isDefeated()){i.stellarForge&&i.stellarForge.updateLightStatus(i.solarMirrors,this.suns);for(const s of i.solarMirrors)if(s.hasLineOfSightToLight(this.suns)&&i.stellarForge&&s.hasLineOfSightToForge(i.stellarForge,[])){const e=s.generateSolarium(t);i.addSolarium(e)}}this.updateSpaceDust(t);const i=[],s=[];for(const t of this.players)t.isDefeated()||(i.push(...t.units),t.stellarForge&&s.push(t.stellarForge));for(const i of this.players){if(i.isDefeated())continue;const s=[];for(const t of this.players)t===i||t.isDefeated()||(s.push(...t.units),t.stellarForge&&s.push(t.stellarForge));for(const e of i.units)if(e.update(t,s),e instanceof p){const t=e.getAndClearLastShotEffects();t.muzzleFlash&&this.muzzleFlashes.push(t.muzzleFlash),t.casing&&this.bulletCasings.push(t.casing),t.bouncingBullet&&this.bouncingBullets.push(t.bouncingBullet)}i.units=i.units.filter(t=>!t.isDead())}for(const i of this.muzzleFlashes)i.update(t);this.muzzleFlashes=this.muzzleFlashes.filter(t=>!t.shouldDespawn());for(const i of this.bulletCasings){i.update(t);for(const t of this.spaceDust)if(i.position.distanceTo(t.position)<5){const s=new n(t.position.x-i.position.x,t.position.y-i.position.y).normalize();t.applyForce(new n(50*s.x,50*s.y)),i.applyCollision(new n(50*-s.x,50*-s.y))}}this.bulletCasings=this.bulletCasings.filter(t=>!t.shouldDespawn());for(const i of this.bouncingBullets)i.update(t);this.bouncingBullets=this.bouncingBullets.filter(t=>!t.shouldDespawn())}updateSpaceDust(e){for(const o of this.spaceDust){o.update(e);let n=null;for(let e=0;e<this.players.length;e++){const h=this.players[e];if(h.stellarForge&&!h.isDefeated()){const a=o.position.distanceTo(h.stellarForge.position);if(a<t){const t=0===e?i:s;(!n||a<n.distance)&&(n={color:t,distance:a})}}}if(n){const i=1-n.distance/t;o.updateColor(n.color,i)}else o.updateColor(null,0)}for(const t of this.warpGates)if(t.isCharging&&t.chargeTime>=1)for(const i of this.spaceDust){const s=i.position.distanceTo(t.position);if(s<200&&s>5){const o=new n(t.position.x-i.position.x,t.position.y-i.position.y).normalize(),h=new n(-o.y,o.x),a=new n(50*o.x+20*h.x,50*o.y+20*h.y);i.applyForce(new n(a.x*e/s,a.y*e/s))}}}initializeSpaceDust(t,i,s){this.spaceDust=[];for(let e=0;e<t;e++){const t=(Math.random()-.5)*i,e=(Math.random()-.5)*s;this.spaceDust.push(new x(new n(t,e)))}}initializeAsteroids(t,i,s){this.asteroids=[];for(let e=0;e<t;e++){const t=Math.random()*Math.PI*2,e=200+Math.random()*(Math.min(i,s)/2-300),o=Math.cos(t)*e,h=Math.sin(t)*e,r=3+Math.floor(7*Math.random()),l=30+50*Math.random();this.asteroids.push(new a(new n(o,h),r,l))}}checkVictoryConditions(){const t=this.players.filter(t=>!t.isDefeated());return 1===t.length?t[0]:null}initializePlayer(t,i,s){t.stellarForge=new l(i,t);for(const i of s){const s=new r(i,t);t.solarMirrors.push(s)}}}class v{constructor(t){this.camera=new n(0,0),this.zoom=1,this.selectionStart=null,this.selectionEnd=null,this.selectedUnits=new Set,this.canvas=t;const i=t.getContext("2d");if(!i)throw new Error("Could not get 2D context from canvas");this.ctx=i,this.resizeCanvas(),window.addEventListener("resize",()=>this.resizeCanvas())}resizeCanvas(){this.canvas.width=window.innerWidth,this.canvas.height=window.innerHeight}worldToScreen(t){const i=this.canvas.width/2,s=this.canvas.height/2;return new n(i+(t.x-this.camera.x)*this.zoom,s+(t.y-this.camera.y)*this.zoom)}screenToWorld(t,i){const s=this.canvas.width/2,e=this.canvas.height/2;return new n(this.camera.x+(t-s)/this.zoom,this.camera.y+(i-e)/this.zoom)}getFactionColor(t){switch(t){case o.RADIANT:return"#FFD700";case o.AURUM:return"#DAA520";case o.SOLARI:return"#FF8C00";default:return"#FFFFFF"}}drawSun(t){const i=this.worldToScreen(t.position),s=t.radius*this.zoom,e=this.ctx.createRadialGradient(i.x,i.y,0,i.x,i.y,s);e.addColorStop(0,"rgba(255, 255, 150, 1)"),e.addColorStop(.5,"rgba(255, 200, 50, 0.5)"),e.addColorStop(1,"rgba(255, 150, 0, 0)"),this.ctx.fillStyle=e,this.ctx.beginPath(),this.ctx.arc(i.x,i.y,s,0,2*Math.PI),this.ctx.fill(),this.ctx.fillStyle="#FFFF00",this.ctx.beginPath(),this.ctx.arc(i.x,i.y,.6*s,0,2*Math.PI),this.ctx.fill()}drawStellarForge(t,i){const s=this.worldToScreen(t.position),e=40*this.zoom;this.ctx.fillStyle=i,this.ctx.strokeStyle=t.isReceivingLight?"#00FF00":"#FF0000",this.ctx.lineWidth=3,this.ctx.beginPath();for(let t=0;t<6;t++){const i=Math.PI/3*t,o=s.x+e*Math.cos(i),n=s.y+e*Math.sin(i);0===t?this.ctx.moveTo(o,n):this.ctx.lineTo(o,n)}this.ctx.closePath(),this.ctx.fill(),this.ctx.stroke();const o=2*e,n=s.x-o/2,h=s.y-e-15;this.ctx.fillStyle="#333",this.ctx.fillRect(n,h,o,6);const a=t.health/1e3;this.ctx.fillStyle=a>.5?"#00FF00":a>.25?"#FFFF00":"#FF0000",this.ctx.fillRect(n,h,o*a,6)}drawSolarMirror(t,i){const s=this.worldToScreen(t.position),e=20*this.zoom;this.ctx.fillStyle=i,this.ctx.strokeStyle="#FFFFFF",this.ctx.lineWidth=2,this.ctx.beginPath(),this.ctx.moveTo(s.x,s.y-e),this.ctx.lineTo(s.x+e,s.y),this.ctx.lineTo(s.x,s.y+e),this.ctx.lineTo(s.x-e,s.y),this.ctx.closePath(),this.ctx.fill(),this.ctx.stroke(),t.efficiency<1&&(this.ctx.fillStyle="rgba(255, 0, 0, 0.5)",this.ctx.beginPath(),this.ctx.arc(s.x,s.y,.5*e,0,2*Math.PI),this.ctx.fill())}drawSpaceDust(t){const i=this.worldToScreen(t.position),s=2*this.zoom;this.ctx.fillStyle=t.currentColor,this.ctx.beginPath(),this.ctx.arc(i.x,i.y,s,0,2*Math.PI),this.ctx.fill()}drawAsteroid(t){const i=t.getWorldVertices();if(0===i.length)return;const s=i.map(t=>this.worldToScreen(t));this.ctx.fillStyle="#666666",this.ctx.strokeStyle="#888888",this.ctx.lineWidth=2,this.ctx.beginPath(),this.ctx.moveTo(s[0].x,s[0].y);for(let t=1;t<s.length;t++)this.ctx.lineTo(s[t].x,s[t].y);this.ctx.closePath(),this.ctx.fill(),this.ctx.stroke()}drawSunRays(t){const i=this.ctx.createRadialGradient(this.canvas.width/2,this.canvas.height/2,0,this.canvas.width/2,this.canvas.height/2,Math.max(this.canvas.width,this.canvas.height));i.addColorStop(0,"rgba(255, 255, 200, 0.1)"),i.addColorStop(1,"rgba(255, 255, 200, 0)"),this.ctx.fillStyle=i,this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height);for(const i of t.suns)for(const s of t.asteroids){const t=s.getWorldVertices();for(let s=0;s<t.length;s++){const o=t[s],h=t[(s+1)%t.length],a=new n((o.x+h.x)/2,(o.y+h.y)/2),r=new n(i.position.x-a.x,i.position.y-a.y),l=new n(-(h.y-o.y),h.x-o.x);if(r.x*l.x+r.y*l.y<0){const t=new n(o.x-i.position.x,o.y-i.position.y).normalize(),s=new n(h.x-i.position.x,h.y-i.position.y).normalize(),a=new n(o.x+t.x*e,o.y+t.y*e),r=new n(h.x+s.x*e,h.y+s.y*e),l=this.worldToScreen(o),c=this.worldToScreen(h),d=this.worldToScreen(a),x=this.worldToScreen(r);this.ctx.fillStyle="rgba(0, 0, 20, 0.5)",this.ctx.beginPath(),this.ctx.moveTo(l.x,l.y),this.ctx.lineTo(c.x,c.y),this.ctx.lineTo(x.x,x.y),this.ctx.lineTo(d.x,d.y),this.ctx.closePath(),this.ctx.fill()}}}}drawInfluenceCircle(t,i,s){const e=this.worldToScreen(t),o=i*this.zoom;this.ctx.strokeStyle=s,this.ctx.lineWidth=2,this.ctx.globalAlpha=.3,this.ctx.beginPath(),this.ctx.arc(e.x,e.y,o,0,2*Math.PI),this.ctx.stroke(),this.ctx.globalAlpha=1}drawWarpGate(t){const i=this.worldToScreen(t.position),s=50*this.zoom,e=t.chargeTime/6,o=Math.min(s,e*s);if(t.isComplete){this.ctx.fillStyle="rgba(0, 255, 255, 0.3)",this.ctx.beginPath(),this.ctx.arc(i.x,i.y,s,0,2*Math.PI),this.ctx.fill(),this.ctx.strokeStyle="#00FFFF",this.ctx.lineWidth=3,this.ctx.beginPath(),this.ctx.arc(i.x,i.y,s,0,2*Math.PI),this.ctx.stroke();const t=20*this.zoom,e=s+30*this.zoom,o=[0,Math.PI/2,Math.PI,3*Math.PI/2];for(let s=0;s<4;s++){const n=o[s],h=i.x+Math.cos(n)*e,a=i.y+Math.sin(n)*e;this.ctx.fillStyle="#444444",this.ctx.strokeStyle="#00FFFF",this.ctx.lineWidth=2,this.ctx.beginPath(),this.ctx.arc(h,a,t,0,2*Math.PI),this.ctx.fill(),this.ctx.stroke(),this.ctx.fillStyle="#FFFFFF",this.ctx.font=12*this.zoom+"px Arial",this.ctx.textAlign="center",this.ctx.textBaseline="middle",this.ctx.fillText(`B${s+1}`,h,a)}this.ctx.textAlign="left",this.ctx.textBaseline="alphabetic"}else this.ctx.strokeStyle="#00FFFF",this.ctx.lineWidth=3,this.ctx.globalAlpha=.5+.2*Math.sin(5*t.chargeTime),this.ctx.beginPath(),this.ctx.arc(i.x,i.y,o,0,2*Math.PI),this.ctx.stroke(),this.ctx.globalAlpha=1,this.ctx.strokeStyle="#FFFFFF",this.ctx.lineWidth=5,this.ctx.beginPath(),this.ctx.arc(i.x,i.y,o+5,0,e*Math.PI*2),this.ctx.stroke()}drawUnit(t,i){const s=this.worldToScreen(t.position),e=8*this.zoom,o=this.selectedUnits.has(t);o&&(this.ctx.strokeStyle="#00FF00",this.ctx.lineWidth=3,this.ctx.beginPath(),this.ctx.arc(s.x,s.y,e+4,0,2*Math.PI),this.ctx.stroke()),this.ctx.fillStyle=i,this.ctx.strokeStyle=o?"#00FF00":"#FFFFFF",this.ctx.lineWidth=o?2:1,this.ctx.beginPath(),this.ctx.arc(s.x,s.y,e,0,2*Math.PI),this.ctx.fill(),this.ctx.stroke();const n=3*e,h=s.x-n/2,a=s.y-e-8;this.ctx.fillStyle="#333",this.ctx.fillRect(h,a,n,3);const r=t.health/t.maxHealth;if(this.ctx.fillStyle=r>.5?"#00FF00":r>.25?"#FFFF00":"#FF0000",this.ctx.fillRect(h,a,n*r,3),t.target){const i=t.target.position.x-t.position.x,o=t.target.position.y-t.position.y,n=Math.atan2(o,i);this.ctx.strokeStyle="#FFFFFF",this.ctx.lineWidth=2,this.ctx.beginPath(),this.ctx.moveTo(s.x,s.y),this.ctx.lineTo(s.x+Math.cos(n)*e*1.5,s.y+Math.sin(n)*e*1.5),this.ctx.stroke()}}drawMuzzleFlash(t){const i=this.worldToScreen(t.position),s=5*this.zoom,e=1-t.lifetime/t.maxLifetime;this.ctx.save(),this.ctx.translate(i.x,i.y),this.ctx.rotate(t.angle),this.ctx.fillStyle=`rgba(255, 255, 100, ${e})`,this.ctx.beginPath(),this.ctx.ellipse(0,0,2*s,s,0,0,2*Math.PI),this.ctx.fill(),this.ctx.restore()}drawBulletCasing(t){const i=this.worldToScreen(t.position),s=3*this.zoom,e=5*this.zoom,o=1-t.lifetime/t.maxLifetime;this.ctx.save(),this.ctx.translate(i.x,i.y),this.ctx.rotate(t.rotation),this.ctx.fillStyle=`rgba(255, 215, 0, ${o})`,this.ctx.fillRect(-s/2,-e/2,s,e),this.ctx.restore()}drawBouncingBullet(t){const i=this.worldToScreen(t.position),s=3*this.zoom,e=1-t.lifetime/t.maxLifetime;this.ctx.fillStyle=`rgba(255, 255, 0, ${e})`,this.ctx.beginPath(),this.ctx.arc(i.x,i.y,s,0,2*Math.PI),this.ctx.fill()}drawGrave(t,i){this.drawUnit(t,i);const s=this.worldToScreen(t.position),e=10*this.zoom;this.ctx.strokeStyle="#FFFFFF",this.ctx.lineWidth=2*this.zoom,this.ctx.beginPath(),this.ctx.moveTo(s.x,s.y-e),this.ctx.lineTo(s.x,s.y+e),this.ctx.moveTo(s.x-.7*e,s.y-.3*e),this.ctx.lineTo(s.x+.7*e,s.y-.3*e),this.ctx.stroke();for(const s of t.getProjectiles())this.drawGraveProjectile(s,i)}drawGraveProjectile(t,i){const s=this.worldToScreen(t.position),e=4*this.zoom;if(t.isAttacking&&t.trail.length>1){this.ctx.strokeStyle=i,this.ctx.lineWidth=2*this.zoom,this.ctx.globalAlpha=.5,this.ctx.beginPath();for(let i=0;i<t.trail.length;i++){const s=this.worldToScreen(t.trail[i]);0===i?this.ctx.moveTo(s.x,s.y):this.ctx.lineTo(s.x,s.y)}this.ctx.stroke(),this.ctx.globalAlpha=1}this.ctx.fillStyle=i,this.ctx.strokeStyle="#FFFFFF",this.ctx.lineWidth=1*this.zoom,this.ctx.beginPath(),this.ctx.arc(s.x,s.y,e,0,2*Math.PI),this.ctx.fill(),this.ctx.stroke(),t.isAttacking&&(this.ctx.fillStyle="rgba(255, 255, 255, 0.3)",this.ctx.beginPath(),this.ctx.arc(s.x,s.y,1.5*e,0,2*Math.PI),this.ctx.fill())}drawConnections(t,i){if(!t.stellarForge)return;const s=this.worldToScreen(t.stellarForge.position);for(const e of t.solarMirrors)if(e.hasLineOfSightToLight(i)&&e.hasLineOfSightToForge(t.stellarForge,[])){const t=this.worldToScreen(e.position);this.ctx.strokeStyle="rgba(255, 255, 0, 0.3)",this.ctx.lineWidth=2,this.ctx.setLineDash([5,5]),this.ctx.beginPath(),this.ctx.moveTo(t.x,t.y),this.ctx.lineTo(s.x,s.y),this.ctx.stroke(),this.ctx.setLineDash([])}}drawUI(t){this.ctx.fillStyle="rgba(0, 0, 0, 0.7)",this.ctx.fillRect(10,10,300,200),this.ctx.fillStyle="#FFFFFF",this.ctx.font="16px Arial",this.ctx.fillText("SoL - Speed of Light RTS",20,30),this.ctx.fillText(`Game Time: ${t.gameTime.toFixed(1)}s`,20,50),this.ctx.fillText(`Dust Particles: ${t.spaceDust.length}`,20,70),this.ctx.fillText(`Asteroids: ${t.asteroids.length}`,20,90),this.ctx.fillText(`Warp Gates: ${t.warpGates.length}`,20,110);let i=140;for(const s of t.players){const t=this.getFactionColor(s.faction);if(this.ctx.fillStyle=t,this.ctx.fillText(`${s.name} (${s.faction})`,20,i),this.ctx.fillStyle="#FFFFFF",this.ctx.fillText(`Solarium: ${s.solarium.toFixed(1)}`,20,i+20),s.stellarForge){const t=s.stellarForge.isReceivingLight?"‚úì Light":"‚úó No Light";this.ctx.fillText(`${t} | HP: ${s.stellarForge.health.toFixed(0)}`,20,i+40)}i+=60}this.ctx.fillStyle="rgba(0, 0, 0, 0.7)",this.ctx.fillRect(10,this.canvas.height-100,450,90),this.ctx.fillStyle="#FFFFFF",this.ctx.font="14px Arial",this.ctx.fillText("Controls: Drag to select units",20,this.canvas.height-75),this.ctx.fillText("Pan: WASD/Arrows or mouse edge or two-finger drag",20,this.canvas.height-55),this.ctx.fillText("Zoom: Scroll/Pinch (zooms toward cursor)",20,this.canvas.height-35),this.ctx.fillText("Hold still 6 seconds in influence to open warp gate",20,this.canvas.height-15)}drawSelectionRectangle(){if(!this.selectionStart||!this.selectionEnd)return;const t=Math.min(this.selectionStart.x,this.selectionEnd.x),i=Math.min(this.selectionStart.y,this.selectionEnd.y),s=Math.abs(this.selectionEnd.x-this.selectionStart.x),e=Math.abs(this.selectionEnd.y-this.selectionStart.y);this.ctx.strokeStyle="rgba(0, 255, 0, 0.8)",this.ctx.lineWidth=2,this.ctx.setLineDash([5,5]),this.ctx.strokeRect(t,i,s,e),this.ctx.fillStyle="rgba(0, 255, 0, 0.1)",this.ctx.fillRect(t,i,s,e),this.ctx.setLineDash([])}render(e){this.ctx.fillStyle="#000011",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.ctx.fillStyle="#FFFFFF";for(let t=0;t<100;t++){const i=137.5*t%this.canvas.width,s=217.3*t%this.canvas.height,e=t%3*.5+.5;this.ctx.fillRect(i,s,e,e)}for(const t of e.spaceDust)this.drawSpaceDust(t);for(const t of e.suns)this.drawSun(t);this.drawSunRays(e);for(const t of e.asteroids)this.drawAsteroid(t);for(let o=0;o<e.players.length;o++){const n=e.players[o];if(n.stellarForge&&!n.isDefeated()){const e=0===o?i:s;this.drawInfluenceCircle(n.stellarForge.position,t,e)}}for(const t of e.players)t.isDefeated()||this.drawConnections(t,e.suns);for(const t of e.players){if(t.isDefeated())continue;const i=this.getFactionColor(t.faction);for(const s of t.solarMirrors)this.drawSolarMirror(s,i);t.stellarForge&&this.drawStellarForge(t.stellarForge,i)}for(const t of e.warpGates)this.drawWarpGate(t);for(const t of e.players){if(t.isDefeated())continue;const i=this.getFactionColor(t.faction);for(const s of t.units)s instanceof w?this.drawGrave(s,i):this.drawUnit(s,i)}for(const t of e.muzzleFlashes)this.drawMuzzleFlash(t);for(const t of e.bulletCasings)this.drawBulletCasing(t);for(const t of e.bouncingBullets)this.drawBouncingBullet(t);this.drawUI(e),this.drawSelectionRectangle();const o=e.checkVictoryConditions();o&&(this.ctx.fillStyle="rgba(0, 0, 0, 0.8)",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.ctx.fillStyle=this.getFactionColor(o.faction),this.ctx.font="bold 48px Arial",this.ctx.textAlign="center",this.ctx.fillText(`${o.name} WINS!`,this.canvas.width/2,this.canvas.height/2),this.ctx.textAlign="left")}setZoom(t){this.zoom=Math.max(.5,Math.min(2,t))}setCameraPosition(t){this.camera=t}}class T{constructor(){this.onStartCallback=null,this.menuElement=this.createMenuElement(),document.body.appendChild(this.menuElement)}createMenuElement(){const t=document.createElement("div");t.id="mainMenu",t.style.position="fixed",t.style.top="0",t.style.left="0",t.style.width="100%",t.style.height="100%",t.style.backgroundColor="rgba(0, 0, 10, 0.95)",t.style.display="flex",t.style.flexDirection="column",t.style.justifyContent="center",t.style.alignItems="center",t.style.zIndex="1000",t.style.fontFamily="Arial, sans-serif",t.style.color="#FFFFFF";const i=document.createElement("h1");i.textContent="SoL",i.style.fontSize="72px",i.style.marginBottom="10px",i.style.color="#FFD700",i.style.textShadow="0 0 20px rgba(255, 215, 0, 0.5)",t.appendChild(i);const s=document.createElement("h2");s.textContent="Speed of Light RTS",s.style.fontSize="24px",s.style.marginBottom="50px",s.style.color="#AAAAAA",t.appendChild(s);const e=document.createElement("p");e.textContent="Battle for supremacy around stars using light as a resource",e.style.fontSize="16px",e.style.marginBottom="40px",e.style.maxWidth="500px",e.style.textAlign="center",e.style.lineHeight="1.5",t.appendChild(e);const o=document.createElement("button");o.textContent="START GAME",o.style.fontSize="24px",o.style.padding="15px 40px",o.style.backgroundColor="#FFD700",o.style.color="#000000",o.style.border="none",o.style.borderRadius="5px",o.style.cursor="pointer",o.style.fontWeight="bold",o.style.transition="all 0.3s",o.addEventListener("mouseenter",()=>{o.style.backgroundColor="#FFA500",o.style.transform="scale(1.05)"}),o.addEventListener("mouseleave",()=>{o.style.backgroundColor="#FFD700",o.style.transform="scale(1)"}),o.addEventListener("click",()=>{this.hide(),this.onStartCallback&&this.onStartCallback()}),t.appendChild(o);const n=document.createElement("div");return n.style.marginTop="60px",n.style.fontSize="14px",n.style.color="#888888",n.innerHTML='\n            <div style="text-align: center;">\n                <div>‚ú® Ray-traced lighting and shadows</div>\n                <div style="margin-top: 5px;">üåå Asteroid obstacles with dynamic polygons</div>\n                <div style="margin-top: 5px;">‚≠ê Solar mirrors and resource collection</div>\n                <div style="margin-top: 5px;">üéÆ Touch and mouse controls</div>\n            </div>\n        ',t.appendChild(n),t}onStart(t){this.onStartCallback=t}hide(){this.menuElement.style.display="none"}show(){this.menuElement.style.display="flex"}destroy(){this.menuElement.parentNode&&this.menuElement.parentNode.removeChild(this.menuElement)}}class M{constructor(){this.game=null,this.lastTime=0,this.isRunning=!1,this.holdStartTime=null,this.holdPosition=null,this.currentWarpGate=null,this.selectedUnits=new Set,this.isSelecting=!1,this.selectionStartScreen=null;const t=document.getElementById("gameCanvas");if(!t)throw new Error("Canvas element not found");this.renderer=new v(t),this.menu=new T,this.menu.onStart(()=>this.startNewGame()),this.setupInputHandlers(t)}startNewGame(){this.game=function(t){const i=new F;i.suns.push(new c(new n(0,0),1,100));const s=[[new n(-500,0),[new n(-450,0),new n(-400,0)]],[new n(500,0),[new n(450,0),new n(400,0)]]];for(let e=0;e<t.length&&!(e>=s.length);e++){const[o,h]=t[e],a=new d(o,h),[r,l]=s[e];i.initializePlayer(a,r,l);const c=0===e?200:-200;a.units.push(new p(new n(r.x+c,r.y-80),a)),a.units.push(new p(new n(r.x+c,r.y),a)),a.units.push(new p(new n(r.x+c,r.y+80),a));const x=0===e?150:-150;a.units.push(new w(new n(r.x+x,r.y-50),a)),a.units.push(new w(new n(r.x+x,r.y+50),a)),i.players.push(a)}return i.initializeSpaceDust(1e3,2e3,2e3),i.initializeAsteroids(10,2e3,2e3),i.isRunning=!0,i}([["Player 1",o.RADIANT],["Player 2",o.AURUM]]),this.start()}setupInputHandlers(t){let i=!1,s=!1,e=0,o=0,h=0,a=0;const r=20,l=new Set;t.addEventListener("wheel",t=>{t.preventDefault();const i=this.renderer.screenToWorld(t.clientX,t.clientY),s=t.deltaY>0?.9:1.1,e=this.renderer.zoom;this.renderer.setZoom(e*s);const o=this.renderer.screenToWorld(t.clientX,t.clientY),h=this.renderer.camera;this.renderer.setCameraPosition(new n(h.x+(i.x-o.x),h.y+(i.y-o.y)))});const c=(t,i)=>{e=t,o=i,this.selectionStartScreen=new n(t,i),this.isSelecting=!1;const s=this.renderer.screenToWorld(t,i);this.startHold(s)},d=(t,h,a=!1)=>{if(!s)return e=t,void(o=h);const r=t-e,l=h-o;if(Math.sqrt(r*r+l*l)>5)if(a){i||(i=!0,this.cancelHold(),this.renderer.selectionStart=null,this.renderer.selectionEnd=null);const t=this.renderer.camera;this.renderer.setCameraPosition(new n(t.x-r/this.renderer.zoom,t.y-l/this.renderer.zoom))}else this.isSelecting||i||(this.isSelecting=!0,this.cancelHold()),this.isSelecting&&(this.renderer.selectionStart=this.selectionStartScreen,this.renderer.selectionEnd=new n(t,h));e=t,o=h},x=()=>{if(this.isSelecting&&this.selectionStartScreen&&this.game){const t=new n(e,o);this.selectUnitsInRectangle(this.selectionStartScreen,t)}i=!1,s=!1,this.isSelecting=!1,this.selectionStartScreen=null,this.renderer.selectionStart=null,this.renderer.selectionEnd=null,this.endHold()};t.addEventListener("mousedown",t=>{s=!0,c(t.clientX,t.clientY)}),t.addEventListener("mousemove",t=>{h=t.clientX,a=t.clientY,d(t.clientX,t.clientY,!1)}),t.addEventListener("mouseup",()=>{x()}),t.addEventListener("mouseleave",()=>{x()}),t.addEventListener("touchstart",t=>{if(1===t.touches.length)t.preventDefault(),s=!0,c(t.touches[0].clientX,t.touches[0].clientY);else if(2===t.touches.length){t.preventDefault(),s=!0,i=!1;const n=t.touches[0];e=n.clientX,o=n.clientY,this.cancelHold()}},{passive:!1}),t.addEventListener("touchmove",t=>{if(1===t.touches.length&&s){t.preventDefault();const i=t.touches[0];d(i.clientX,i.clientY,!1)}else if(2===t.touches.length){t.preventDefault();const i=t.touches[0];d(i.clientX,i.clientY,!0)}},{passive:!1}),t.addEventListener("touchend",()=>{x()}),window.addEventListener("keydown",t=>{const i=t.key.toLowerCase();["w","a","s","d","arrowup","arrowdown","arrowleft","arrowright"].includes(i)&&(t.preventDefault(),l.add(i))}),window.addEventListener("keyup",t=>{const i=t.key.toLowerCase();l.delete(i)});const u=()=>{const e=l.size>0,o=!s&&!i&&(h<r||h>t.width-r||a<r||a>t.height-r);if(e||o){const i=this.renderer.camera;let s=0,e=0;(l.has("w")||l.has("arrowup"))&&(e-=10),(l.has("s")||l.has("arrowdown"))&&(e+=10),(l.has("a")||l.has("arrowleft"))&&(s-=10),(l.has("d")||l.has("arrowright"))&&(s+=10),o&&(h<r&&(s-=5),h>t.width-r&&(s+=5),a<r&&(e-=5),a>t.height-r&&(e+=5)),0===s&&0===e||this.renderer.setCameraPosition(new n(i.x+s/this.renderer.zoom,i.y+e/this.renderer.zoom))}requestAnimationFrame(u)};u()}startHold(i){if(!this.game)return;const s=this.game.players[0];s.stellarForge&&i.distanceTo(s.stellarForge.position)<t&&(this.holdStartTime=Date.now(),this.holdPosition=i)}selectUnitsInRectangle(t,i){if(!this.game)return;const s=this.renderer.screenToWorld(t.x,t.y),e=this.renderer.screenToWorld(i.x,i.y),o=Math.min(s.x,e.x),n=Math.max(s.x,e.x),h=Math.min(s.y,e.y),a=Math.max(s.y,e.y);this.selectedUnits.clear();const r=this.game.players[0];if(r&&!r.isDefeated()){for(const t of r.units)t.position.x>=o&&t.position.x<=n&&t.position.y>=h&&t.position.y<=a&&this.selectedUnits.add(t);this.renderer.selectedUnits=this.selectedUnits,console.log(`Selected ${this.selectedUnits.size} units`)}}cancelHold(){if(this.game){if(this.currentWarpGate){this.currentWarpGate.cancel(),this.scatterParticles(this.currentWarpGate.position);const t=this.game.warpGates.indexOf(this.currentWarpGate);t>-1&&this.game.warpGates.splice(t,1)}this.holdStartTime=null,this.holdPosition=null,this.currentWarpGate=null}}endHold(){this.holdStartTime=null,this.holdPosition=null}scatterParticles(t){if(this.game)for(const i of this.game.spaceDust)if(i.position.distanceTo(t)<150){const s=new n(i.position.x-t.x,i.position.y-t.y).normalize();i.applyForce(new n(200*s.x,200*s.y))}}update(t){if(this.game){if(this.game.isRunning&&this.game.update(t),this.holdStartTime&&this.holdPosition&&(Date.now()-this.holdStartTime)/1e3>=1&&!this.currentWarpGate){const t=this.game.players[0];this.currentWarpGate=new S(this.holdPosition,t),this.currentWarpGate.startCharging(),this.game.warpGates.push(this.currentWarpGate)}if(this.currentWarpGate){const i=null!==this.holdStartTime&&null!==this.holdPosition;this.currentWarpGate.update(t,i)}}}render(){this.game&&this.renderer.render(this.game)}gameLoop(t){if(!this.isRunning)return;const i=0===this.lastTime?0:(t-this.lastTime)/1e3;this.lastTime=t,this.update(Math.min(i,.1)),this.render(),requestAnimationFrame(t=>this.gameLoop(t))}start(){this.game&&(this.isRunning=!0,this.lastTime=0,requestAnimationFrame(t=>this.gameLoop(t)))}stop(){this.isRunning=!1}}document.addEventListener("DOMContentLoaded",()=>{new M})})();