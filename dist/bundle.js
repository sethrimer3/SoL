(()=>{"use strict";var t;!function(t){t.RADIANT="Radiant",t.AURUM="Aurum",t.SOLARI="Solari"}(t||(t={}));class i{constructor(t,i){this.x=t,this.y=i}distanceTo(t){return Math.sqrt(Math.pow(this.x-t.x,2)+Math.pow(this.y-t.y,2))}normalize(){const t=Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2));return 0===t?new i(0,0):new i(this.x/t,this.y/t)}}class s{constructor(t,i,s=1){this.origin=t,this.direction=i,this.intensity=s}intersects(t,i){return!0}}class e{constructor(t,i){this.position=t,this.owner=i,this.health=100,this.efficiency=1}hasLineOfSightToLight(t){return t.length>0}hasLineOfSightToForge(t,i){return!0}generateSolarium(t){return 10*this.efficiency*t}}class o{constructor(t,i){this.position=t,this.owner=i,this.health=1e3,this.isReceivingLight=!1,this.unitQueue=[]}canProduceUnits(){return this.isReceivingLight&&this.health>0}produceUnit(t,i,s){return!(!this.canProduceUnits()||s<i||(this.unitQueue.push(t),0))}updateLightStatus(t,i){this.isReceivingLight=!1;for(const s of t)if(s.hasLineOfSightToLight(i)&&s.hasLineOfSightToForge(this,[])){this.isReceivingLight=!0;break}}}class h{constructor(t,i=1,s=100){this.position=t,this.intensity=i,this.radius=s}emitLight(t){return new s(this.position,t,this.intensity)}}class n{constructor(t,i){this.name=t,this.faction=i,this.solarium=100,this.stellarForge=null,this.solarMirrors=[],this.units=[]}isDefeated(){return null===this.stellarForge||this.stellarForge.health<=0}addSolarium(t){this.solarium+=t}spendSolarium(t){return this.solarium>=t&&(this.solarium-=t,!0)}}class a{constructor(t,s){this.position=t,this.baseColor="#888888",this.currentColor="#888888",this.velocity=s||new i(2*(Math.random()-.5),2*(Math.random()-.5))}update(t){this.position.x+=this.velocity.x*t,this.position.y+=this.velocity.y*t,this.velocity.x*=.98,this.velocity.y*=.98}applyForce(t){this.velocity.x+=t.x,this.velocity.y+=t.y}updateColor(t,i){this.currentColor=t&&i>0?this.blendColors(this.baseColor,t,i):this.baseColor}blendColors(t,i,s){const e=parseInt(t.slice(1),16),o=parseInt(i.slice(1),16),h=e>>16&255,n=e>>8&255,a=255&e,r=o>>16&255,l=o>>8&255,c=255&o;return`#${(Math.round(h+(r-h)*s)<<16|Math.round(n+(l-n)*s)<<8|Math.round(a+(c-a)*s)).toString(16).padStart(6,"0")}`}}class r{constructor(t,i){this.position=t,this.owner=i,this.chargeTime=0,this.isCharging=!1,this.isComplete=!1,this.health=100,this.particles=[]}update(t,i){this.isCharging&&!this.isComplete&&(i?(this.chargeTime+=t,this.chargeTime>=6&&(this.isComplete=!0,this.isCharging=!1)):this.cancel())}startCharging(){this.isCharging=!0,this.chargeTime=0}takeDamage(t){return this.health-=t,this.health<=0&&(this.cancel(),!0)}cancel(){this.isCharging=!1,this.isComplete=!1}shouldEmitShockwave(){return this.chargeTime>=1&&this.chargeTime<1.1}}class l{constructor(){this.players=[],this.suns=[],this.spaceDust=[],this.warpGates=[],this.gameTime=0,this.isRunning=!1}update(t){this.gameTime+=t;for(const i of this.players)if(!i.isDefeated()){i.stellarForge&&i.stellarForge.updateLightStatus(i.solarMirrors,this.suns);for(const s of i.solarMirrors)if(s.hasLineOfSightToLight(this.suns)&&i.stellarForge&&s.hasLineOfSightToForge(i.stellarForge,[])){const e=s.generateSolarium(t);i.addSolarium(e)}}this.updateSpaceDust(t),this.updateWarpGates(t)}updateSpaceDust(t){for(const i of this.spaceDust){i.update(t);let s=null;for(let t=0;t<this.players.length;t++){const e=this.players[t];if(e.stellarForge&&!e.isDefeated()){const o=i.position.distanceTo(e.stellarForge.position);if(o<300){const i=0===t?"#0066FF":"#FF0000";(!s||o<s.distance)&&(s={color:i,distance:o})}}}if(s){const t=1-s.distance/300;i.updateColor(s.color,t)}else i.updateColor(null,0)}for(const s of this.warpGates)if(s.isCharging&&s.chargeTime>=1){const e=200;for(const o of this.spaceDust){const h=o.position.distanceTo(s.position);if(h<e&&h>5){const e=new i(s.position.x-o.position.x,s.position.y-o.position.y).normalize(),n=new i(-e.y,e.x),a=new i(50*e.x+20*n.x,50*e.y+20*n.y);o.applyForce(new i(a.x*t/h,a.y*t/h))}}}}updateWarpGates(t){}initializeSpaceDust(t,s,e){this.spaceDust=[];for(let o=0;o<t;o++){const t=(Math.random()-.5)*s,o=(Math.random()-.5)*e;this.spaceDust.push(new a(new i(t,o)))}}checkVictoryConditions(){const t=this.players.filter(t=>!t.isDefeated());return 1===t.length?t[0]:null}initializePlayer(t,i,s){t.stellarForge=new o(i,t);for(const i of s){const s=new e(i,t);t.solarMirrors.push(s)}}}class c{constructor(t){this.camera=new i(0,0),this.zoom=1,this.canvas=t;const s=t.getContext("2d");if(!s)throw new Error("Could not get 2D context from canvas");this.ctx=s,this.resizeCanvas(),window.addEventListener("resize",()=>this.resizeCanvas())}resizeCanvas(){this.canvas.width=window.innerWidth,this.canvas.height=window.innerHeight}worldToScreen(t){const s=this.canvas.width/2,e=this.canvas.height/2;return new i(s+(t.x-this.camera.x)*this.zoom,e+(t.y-this.camera.y)*this.zoom)}screenToWorld(t,s){const e=this.canvas.width/2,o=this.canvas.height/2;return new i(this.camera.x+(t-e)/this.zoom,this.camera.y+(s-o)/this.zoom)}getFactionColor(i){switch(i){case t.RADIANT:return"#FFD700";case t.AURUM:return"#DAA520";case t.SOLARI:return"#FF8C00";default:return"#FFFFFF"}}drawSun(t){const i=this.worldToScreen(t.position),s=t.radius*this.zoom,e=this.ctx.createRadialGradient(i.x,i.y,0,i.x,i.y,s);e.addColorStop(0,"rgba(255, 255, 150, 1)"),e.addColorStop(.5,"rgba(255, 200, 50, 0.5)"),e.addColorStop(1,"rgba(255, 150, 0, 0)"),this.ctx.fillStyle=e,this.ctx.beginPath(),this.ctx.arc(i.x,i.y,s,0,2*Math.PI),this.ctx.fill(),this.ctx.fillStyle="#FFFF00",this.ctx.beginPath(),this.ctx.arc(i.x,i.y,.6*s,0,2*Math.PI),this.ctx.fill()}drawStellarForge(t,i){const s=this.worldToScreen(t.position),e=40*this.zoom;this.ctx.fillStyle=i,this.ctx.strokeStyle=t.isReceivingLight?"#00FF00":"#FF0000",this.ctx.lineWidth=3,this.ctx.beginPath();for(let t=0;t<6;t++){const i=Math.PI/3*t,o=s.x+e*Math.cos(i),h=s.y+e*Math.sin(i);0===t?this.ctx.moveTo(o,h):this.ctx.lineTo(o,h)}this.ctx.closePath(),this.ctx.fill(),this.ctx.stroke();const o=2*e,h=s.x-o/2,n=s.y-e-15;this.ctx.fillStyle="#333",this.ctx.fillRect(h,n,o,6);const a=t.health/1e3;this.ctx.fillStyle=a>.5?"#00FF00":a>.25?"#FFFF00":"#FF0000",this.ctx.fillRect(h,n,o*a,6)}drawSolarMirror(t,i){const s=this.worldToScreen(t.position),e=20*this.zoom;this.ctx.fillStyle=i,this.ctx.strokeStyle="#FFFFFF",this.ctx.lineWidth=2,this.ctx.beginPath(),this.ctx.moveTo(s.x,s.y-e),this.ctx.lineTo(s.x+e,s.y),this.ctx.lineTo(s.x,s.y+e),this.ctx.lineTo(s.x-e,s.y),this.ctx.closePath(),this.ctx.fill(),this.ctx.stroke(),t.efficiency<1&&(this.ctx.fillStyle="rgba(255, 0, 0, 0.5)",this.ctx.beginPath(),this.ctx.arc(s.x,s.y,.5*e,0,2*Math.PI),this.ctx.fill())}drawSpaceDust(t){const i=this.worldToScreen(t.position),s=2*this.zoom;this.ctx.fillStyle=t.currentColor,this.ctx.beginPath(),this.ctx.arc(i.x,i.y,s,0,2*Math.PI),this.ctx.fill()}drawInfluenceCircle(t,i,s){const e=this.worldToScreen(t),o=i*this.zoom;this.ctx.strokeStyle=s,this.ctx.lineWidth=2,this.ctx.globalAlpha=.3,this.ctx.beginPath(),this.ctx.arc(e.x,e.y,o,0,2*Math.PI),this.ctx.stroke(),this.ctx.globalAlpha=1}drawWarpGate(t){const i=this.worldToScreen(t.position),s=50*this.zoom,e=Math.min(s,t.chargeTime/6*s);if(t.isComplete){this.ctx.fillStyle="rgba(0, 255, 255, 0.3)",this.ctx.beginPath(),this.ctx.arc(i.x,i.y,s,0,2*Math.PI),this.ctx.fill(),this.ctx.strokeStyle="#00FFFF",this.ctx.lineWidth=3,this.ctx.beginPath(),this.ctx.arc(i.x,i.y,s,0,2*Math.PI),this.ctx.stroke();const t=20*this.zoom,e=s+30*this.zoom,o=[0,Math.PI/2,Math.PI,3*Math.PI/2];for(let s=0;s<4;s++){const h=o[s],n=i.x+Math.cos(h)*e,a=i.y+Math.sin(h)*e;this.ctx.fillStyle="#444444",this.ctx.strokeStyle="#00FFFF",this.ctx.lineWidth=2,this.ctx.beginPath(),this.ctx.arc(n,a,t,0,2*Math.PI),this.ctx.fill(),this.ctx.stroke(),this.ctx.fillStyle="#FFFFFF",this.ctx.font=12*this.zoom+"px Arial",this.ctx.textAlign="center",this.ctx.textBaseline="middle",this.ctx.fillText(`B${s+1}`,n,a)}this.ctx.textAlign="left",this.ctx.textBaseline="alphabetic"}else this.ctx.strokeStyle="#00FFFF",this.ctx.lineWidth=3,this.ctx.globalAlpha=.5+.2*Math.sin(5*t.chargeTime),this.ctx.beginPath(),this.ctx.arc(i.x,i.y,e,0,2*Math.PI),this.ctx.stroke(),this.ctx.globalAlpha=1,this.ctx.strokeStyle="#FFFFFF",this.ctx.lineWidth=5,this.ctx.beginPath(),this.ctx.arc(i.x,i.y,e+5,0,t.chargeTime/6*Math.PI*2),this.ctx.stroke()}drawConnections(t,i){if(!t.stellarForge)return;const s=this.worldToScreen(t.stellarForge.position);for(const e of t.solarMirrors)if(e.hasLineOfSightToLight(i)&&e.hasLineOfSightToForge(t.stellarForge,[])){const t=this.worldToScreen(e.position);this.ctx.strokeStyle="rgba(255, 255, 0, 0.3)",this.ctx.lineWidth=2,this.ctx.setLineDash([5,5]),this.ctx.beginPath(),this.ctx.moveTo(t.x,t.y),this.ctx.lineTo(s.x,s.y),this.ctx.stroke(),this.ctx.setLineDash([])}}drawUI(t){this.ctx.fillStyle="rgba(0, 0, 0, 0.7)",this.ctx.fillRect(10,10,300,200),this.ctx.fillStyle="#FFFFFF",this.ctx.font="16px Arial",this.ctx.fillText("SoL - Speed of Light RTS",20,30),this.ctx.fillText(`Game Time: ${t.gameTime.toFixed(1)}s`,20,50),this.ctx.fillText(`Dust Particles: ${t.spaceDust.length}`,20,70),this.ctx.fillText(`Warp Gates: ${t.warpGates.length}`,20,90);let i=120;for(const s of t.players){const t=this.getFactionColor(s.faction);if(this.ctx.fillStyle=t,this.ctx.fillText(`${s.name} (${s.faction})`,20,i),this.ctx.fillStyle="#FFFFFF",this.ctx.fillText(`Solarium: ${s.solarium.toFixed(1)}`,20,i+20),s.stellarForge){const t=s.stellarForge.isReceivingLight?"✓ Light":"✗ No Light";this.ctx.fillText(`${t} | HP: ${s.stellarForge.health.toFixed(0)}`,20,i+40)}i+=60}this.ctx.fillStyle="rgba(0, 0, 0, 0.7)",this.ctx.fillRect(10,this.canvas.height-80,350,70),this.ctx.fillStyle="#FFFFFF",this.ctx.font="14px Arial",this.ctx.fillText("Controls: Click/Tap to interact",20,this.canvas.height-55),this.ctx.fillText("Scroll/Pinch to zoom, Drag to pan",20,this.canvas.height-35),this.ctx.fillText("Hold still 6 seconds in influence to open warp gate",20,this.canvas.height-15)}render(t){this.ctx.fillStyle="#000011",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.ctx.fillStyle="#FFFFFF";for(let t=0;t<100;t++){const i=137.5*t%this.canvas.width,s=217.3*t%this.canvas.height,e=t%3*.5+.5;this.ctx.fillRect(i,s,e,e)}for(const i of t.spaceDust)this.drawSpaceDust(i);for(const i of t.suns)this.drawSun(i);for(let i=0;i<t.players.length;i++){const s=t.players[i];if(s.stellarForge&&!s.isDefeated()){const t=0===i?"#0066FF":"#FF0000";this.drawInfluenceCircle(s.stellarForge.position,300,t)}}for(const i of t.players)i.isDefeated()||this.drawConnections(i,t.suns);for(const i of t.players){if(i.isDefeated())continue;const t=this.getFactionColor(i.faction);for(const s of i.solarMirrors)this.drawSolarMirror(s,t);i.stellarForge&&this.drawStellarForge(i.stellarForge,t)}for(const i of t.warpGates)this.drawWarpGate(i);this.drawUI(t);const i=t.checkVictoryConditions();i&&(this.ctx.fillStyle="rgba(0, 0, 0, 0.8)",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.ctx.fillStyle=this.getFactionColor(i.faction),this.ctx.font="bold 48px Arial",this.ctx.textAlign="center",this.ctx.fillText(`${i.name} WINS!`,this.canvas.width/2,this.canvas.height/2),this.ctx.textAlign="left")}setZoom(t){this.zoom=Math.max(.5,Math.min(2,t))}setCameraPosition(t){this.camera=t}}class d{constructor(){this.lastTime=0,this.isRunning=!1,this.holdStartTime=null,this.holdPosition=null,this.currentWarpGate=null;const s=document.getElementById("gameCanvas");if(!s)throw new Error("Canvas element not found");this.renderer=new c(s),this.game=function(t){const s=new l;s.suns.push(new h(new i(0,0),1,100));const e=[[new i(-500,0),[new i(-450,0),new i(-400,0)]],[new i(500,0),[new i(450,0),new i(400,0)]]];for(let i=0;i<t.length&&!(i>=e.length);i++){const[o,h]=t[i],a=new n(o,h),[r,l]=e[i];s.initializePlayer(a,r,l),s.players.push(a)}return s.initializeSpaceDust(1e3,2e3,2e3),s.isRunning=!0,s}([["Player 1",t.RADIANT],["Player 2",t.AURUM]]),this.setupInputHandlers(s),this.start()}setupInputHandlers(t){let s=!1,e=0,o=0;t.addEventListener("wheel",t=>{t.preventDefault();const i=t.deltaY>0?.9:1.1;this.renderer.setZoom(this.renderer.zoom*i)});const h=(t,i)=>{e=t,o=i;const s=this.renderer.screenToWorld(t,i);this.startHold(s)},n=(t,h)=>{const n=t-e,a=h-o;if(Math.sqrt(n*n+a*a)>5){s||(s=!0,this.cancelHold());const t=this.renderer.camera;this.renderer.setCameraPosition(new i(t.x-n/this.renderer.zoom,t.y-a/this.renderer.zoom))}e=t,o=h},a=()=>{s=!1,this.endHold()};t.addEventListener("mousedown",t=>{h(t.clientX,t.clientY)}),t.addEventListener("mousemove",t=>{n(t.clientX,t.clientY)}),t.addEventListener("mouseup",()=>{a()}),t.addEventListener("mouseleave",()=>{a()}),t.addEventListener("touchstart",t=>{1===t.touches.length&&(t.preventDefault(),h(t.touches[0].clientX,t.touches[0].clientY))},{passive:!1}),t.addEventListener("touchmove",t=>{1===t.touches.length&&(t.preventDefault(),n(t.touches[0].clientX,t.touches[0].clientY))},{passive:!1}),t.addEventListener("touchend",()=>{a()})}startHold(t){const i=this.game.players[0];if(!i.stellarForge)return;const s=t.distanceTo(i.stellarForge.position);s<300?(this.holdStartTime=Date.now(),this.holdPosition=t,console.log(`Hold started at (${t.x.toFixed(0)}, ${t.y.toFixed(0)}) - distance: ${s.toFixed(0)}`)):console.log(`Click outside influence zone - distance: ${s.toFixed(0)}`)}cancelHold(){if(this.currentWarpGate){console.log("Warp gate cancelled"),this.currentWarpGate.cancel(),this.scatterParticles(this.currentWarpGate.position);const t=this.game.warpGates.indexOf(this.currentWarpGate);t>-1&&this.game.warpGates.splice(t,1)}this.holdStartTime=null,this.holdPosition=null,this.currentWarpGate=null}endHold(){if(this.holdStartTime){const t=(Date.now()-this.holdStartTime)/1e3;console.log(`Hold ended after ${t.toFixed(1)}s`)}this.holdStartTime=null,this.holdPosition=null}scatterParticles(t){for(const s of this.game.spaceDust)if(s.position.distanceTo(t)<150){const e=new i(s.position.x-t.x,s.position.y-t.y).normalize();s.applyForce(new i(200*e.x,200*e.y))}}update(t){if(this.game.isRunning&&this.game.update(t),this.holdStartTime&&this.holdPosition&&(Date.now()-this.holdStartTime)/1e3>=1&&!this.currentWarpGate){const t=this.game.players[0];this.currentWarpGate=new r(this.holdPosition,t),this.currentWarpGate.startCharging(),this.game.warpGates.push(this.currentWarpGate),console.log(`Warp gate created at (${this.holdPosition.x.toFixed(0)}, ${this.holdPosition.y.toFixed(0)})`)}if(this.currentWarpGate){const i=null!==this.holdStartTime&&null!==this.holdPosition;this.currentWarpGate.update(t,i),this.currentWarpGate.isComplete&&console.log("Warp gate complete! Ready for building selection.")}}render(){this.renderer.render(this.game)}gameLoop(t){if(!this.isRunning)return;const i=0===this.lastTime?0:(t-this.lastTime)/1e3;this.lastTime=t,this.update(Math.min(i,.1)),this.render(),requestAnimationFrame(t=>this.gameLoop(t))}start(){this.isRunning=!0,this.lastTime=0,requestAnimationFrame(t=>this.gameLoop(t))}stop(){this.isRunning=!1}}document.addEventListener("DOMContentLoaded",()=>{new d})})();